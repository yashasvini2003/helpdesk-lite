{% extends "base.html" %}
{% block content %}
<h2>Ticket #{{ ticket.id }} â€“ {{ ticket.title }}</h2>

<div class="row mt-3">
  <div class="col-md-6">
    <h5>Requester</h5>
    <p><strong>Name:</strong> {{ ticket.requester_name }}</p>
    <p><strong>Email:</strong> {{ ticket.contact_email }}</p>
    <p><strong>Location:</strong> {{ ticket.location or "N/A" }}</p>
  </div>
  <div class="col-md-6">
    <h5>Details</h5>
    <p><strong>Device:</strong> {{ ticket.device_type }}</p>
    <p><strong>Category:</strong> {{ ticket.category or "N/A" }}</p>
    <p><strong>Priority:</strong> {{ ticket.priority }}</p>
    <p><strong>Status:</strong> {{ ticket.status }}</p>
    <p><strong>Created:</strong> {{ ticket.created_at }}</p>
    <p><strong>Last Updated:</strong> {{ ticket.updated_at }}</p>
  </div>
</div>

<div class="mt-3">
  <h5>Description</h5>
  <p>{{ ticket.description }}</p>
</div>

<div class="mt-4">
  <h5>Troubleshooting Notes</h5>
  {% if ticket.troubleshooting_notes %}
    <pre class="bg-light p-3">{{ ticket.troubleshooting_notes }}</pre>
  {% else %}
    <p class="text-muted">No troubleshooting notes added yet.</p>
  {% endif %}
</div>

<hr>

<h4>Update Ticket</h4>
<form method="post" action="{{ url_for('update_ticket', ticket_id=ticket.id) }}" class="mt-3">
  <div class="row">
    <div class="mb-3 col-md-4">
      <label class="form-label">Status</label>
      <select name="status" class="form-select">
        {% for s in statuses %}
          <option value="{{ s }}" {% if s == ticket.status %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3 col-md-4">
      <label class="form-label">Priority</label>
      <select name="priority" class="form-select">
        {% for p in priorities %}
          <option value="{{ p }}" {% if p == ticket.priority %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Add Troubleshooting Note</label>
    <textarea name="troubleshooting_notes" class="form-control" rows="3"
              placeholder="Document your troubleshooting steps, findings, or resolutions here."></textarea>
  </div>

  <button type="submit" class="btn btn-primary">Save Changes</button>
  <a href="{{ url_for('list_tickets') }}" class="btn btn-secondary">Back to Tickets</a>
</form>
{% endblock %}
